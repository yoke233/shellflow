{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/shkm/shellflow/config.schema.json",
  "title": "Shellflow Configuration",
  "description": "Configuration file for Shellflow - a Tauri desktop app for orchestrating git worktrees",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for editor validation"
    },
    "main": {
      "type": "object",
      "description": "Configuration for the main terminal pane",
      "properties": {
        "command": {
          "type": ["string", "null"],
          "description": "Command to run in the main terminal pane. If null or omitted, spawns your shell.",
          "default": null
        },
        "fontFamily": {
          "type": "string",
          "description": "Font family for the main terminal",
          "default": "Menlo, Monaco, 'Courier New', monospace"
        },
        "fontSize": {
          "type": "integer",
          "description": "Font size in points for the main terminal",
          "minimum": 6,
          "maximum": 72,
          "default": 13
        },
        "fontLigatures": {
          "type": "boolean",
          "description": "Enable font ligatures (disables WebGL rendering)",
          "default": false
        },
        "padding": {
          "type": "integer",
          "description": "Padding around the terminal content in pixels",
          "minimum": 0,
          "maximum": 64,
          "default": 8
        }
      },
      "additionalProperties": false
    },
    "drawer": {
      "type": "object",
      "description": "Configuration for drawer terminals. All properties are optional and inherit from 'main' if not specified.",
      "properties": {
        "fontFamily": {
          "type": "string",
          "description": "Font family for drawer terminals. Inherits from main if not specified."
        },
        "fontSize": {
          "type": "integer",
          "description": "Font size in points for drawer terminals. Inherits from main if not specified.",
          "minimum": 6,
          "maximum": 72
        },
        "fontLigatures": {
          "type": "boolean",
          "description": "Enable font ligatures (disables WebGL rendering). Inherits from main if not specified."
        },
        "padding": {
          "type": "integer",
          "description": "Padding around the terminal content in pixels. Inherits from main if not specified.",
          "minimum": 0,
          "maximum": 64
        }
      },
      "additionalProperties": false
    },
    "apps": {
      "type": "object",
      "description": "External applications to open directories with",
      "properties": {
        "terminal": {
          "type": "string",
          "description": "Terminal application name (as recognized by the system)",
          "default": "Ghostty"
        },
        "editor": {
          "type": "string",
          "description": "Code editor application name (as recognized by the system)",
          "default": "Zed"
        }
      },
      "additionalProperties": false
    },
    "worktree": {
      "type": "object",
      "description": "Configuration for git worktree management",
      "properties": {
        "directory": {
          "type": "string",
          "description": "Directory where worktrees are created. Supports placeholder: {{ repo_directory }}",
          "default": "{{ repo_directory }}/.worktrees"
        },
        "baseBranch": {
          "description": "Branch to create new worktrees from",
          "default": "auto",
          "oneOf": [
            {
              "type": "string",
              "enum": ["auto", "current"],
              "description": "'auto' uses default branch (main/master), 'current' uses checked out branch"
            },
            {
              "type": "object",
              "description": "Use a specific named branch",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Branch name to create worktrees from"
                }
              },
              "required": ["name"],
              "additionalProperties": false
            }
          ]
        },
        "copy": {
          "type": "object",
          "description": "Configuration for copying files to new worktrees",
          "properties": {
            "gitIgnored": {
              "type": "boolean",
              "description": "Copy gitignored files from the project to new worktrees",
              "default": false
            },
            "except": {
              "type": "array",
              "description": "Glob patterns to exclude from copying",
              "items": {
                "type": "string"
              },
              "default": [".claude", ".worktrees"]
            }
          },
          "additionalProperties": false
        },
        "focusNewBranchNames": {
          "type": "boolean",
          "description": "Focus the branch name input when creating a new worktree, allowing immediate editing",
          "default": false
        },
        "merge": {
          "type": "object",
          "description": "Configuration for merge operations",
          "properties": {
            "strategy": {
              "type": "string",
              "enum": ["merge", "rebase"],
              "description": "Merge strategy to use",
              "default": "merge"
            },
            "deleteWorktree": {
              "type": "boolean",
              "description": "Delete the worktree after successful merge",
              "default": true
            },
            "deleteLocalBranch": {
              "type": "boolean",
              "description": "Delete the local branch after successful merge",
              "default": false
            },
            "deleteRemoteBranch": {
              "type": "boolean",
              "description": "Delete the remote branch after successful merge",
              "default": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "navigation": {
      "type": "object",
      "description": "Reserved for future navigation settings",
      "properties": {},
      "additionalProperties": false
    },
    "indicators": {
      "type": "object",
      "description": "Configuration for activity indicators",
      "properties": {
        "activityTimeout": {
          "type": "integer",
          "description": "Time in ms after last activity before progress indicator turns off",
          "minimum": 0,
          "default": 250
        },
        "showIdleCheck": {
          "type": "boolean",
          "description": "Show checkmark when activity stops (idle state)",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "scratch": {
      "type": "object",
      "description": "Configuration for scratch terminals (general-purpose terminals not tied to any project)",
      "properties": {
        "startOnLaunch": {
          "type": "boolean",
          "description": "Create a scratch terminal when the app launches",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "unfocusedOpacity": {
      "type": "number",
      "description": "Opacity (0.0 to 1.0) applied to unfocused panes (main terminal or drawer). When the main terminal is focused, the drawer gets this opacity, and vice versa.",
      "minimum": 0,
      "maximum": 1,
      "default": 1
    },
    "actions": {
      "type": "object",
      "description": "Configuration for AI-assisted actions",
      "properties": {
        "command": {
          "type": "string",
          "description": "Command to run for AI-assisted actions (e.g., 'claude')",
          "default": "claude"
        },
        "mergeWorktreeWithConflicts": {
          "type": "string",
          "description": "Prompt template for resolving merge conflicts. Variables: {{ worktree_dir }}, {{ worktree_name }}, {{ branch }}, {{ target_branch }}, {{ conflicted_files }}"
        },
        "rebaseWorktreeWithConflicts": {
          "type": "string",
          "description": "Prompt template for resolving rebase conflicts. Variables: {{ worktree_dir }}, {{ worktree_name }}, {{ branch }}, {{ target_branch }}, {{ conflicted_files }}"
        }
      },
      "additionalProperties": false
    },
    "mappings": {
      "type": "object",
      "description": "Keyboard shortcut mappings",
      "properties": {
        "quit": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to quit the application",
          "default": { "mac": "cmd+q", "other": "ctrl+q" }
        },
        "addProject": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to add a new project",
          "default": { "mac": "cmd+o", "other": "ctrl+o" }
        },
        "projectSwitcher": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to open the project switcher",
          "default": { "mac": "cmd+shift+o", "other": "ctrl+shift+o" }
        },
        "newWorkspace": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to create a new workspace (worktree when in project, scratch terminal otherwise)",
          "default": { "mac": "cmd+n", "other": "ctrl+n" }
        },
        "newScratchTerminal": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to create a new scratch terminal (works from anywhere)",
          "default": { "mac": "cmd+shift+n", "other": "ctrl+shift+n" }
        },
        "newTab": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to create a new tab",
          "default": { "mac": "cmd+t", "other": "ctrl+t" }
        },
        "closeTab": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to close the current tab or session",
          "default": { "mac": "cmd+w", "other": "ctrl+w" }
        },
        "toggleDrawer": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to toggle the drawer panel",
          "default": "ctrl+`"
        },
        "toggleRightPanel": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to toggle the right panel",
          "default": { "mac": "cmd+b", "other": "ctrl+b" }
        },
        "expandDrawer": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to expand the drawer to full screen",
          "default": "shift+Escape"
        },
        "commandPalette": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to open the command palette",
          "default": { "mac": "cmd+shift+p", "other": "ctrl+shift+p" }
        },
        "zoomIn": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to increase terminal font size in focused pane",
          "default": { "mac": "cmd+=", "other": "ctrl+=" }
        },
        "zoomOut": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to decrease terminal font size in focused pane",
          "default": { "mac": "cmd+-", "other": "ctrl+-" }
        },
        "zoomReset": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to reset terminal font size in focused pane to base size",
          "default": { "mac": "cmd+shift+0", "other": "ctrl+shift+0" }
        },
        "worktreePrev": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to the previous session",
          "default": { "mac": "ctrl+cmd+k", "other": "ctrl+shift+k" }
        },
        "worktreeNext": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to the next session",
          "default": { "mac": "ctrl+cmd+j", "other": "ctrl+shift+j" }
        },
        "previousView": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch between current and previous view (worktree or project)",
          "default": { "mac": "cmd+'", "other": "ctrl+'" }
        },
        "switchFocus": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch focus between main pane and drawer",
          "default": "ctrl+\\"
        },
        "session1": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 1",
          "default": { "mac": "ctrl+cmd+1", "other": "ctrl+1" }
        },
        "session2": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 2",
          "default": { "mac": "ctrl+cmd+2", "other": "ctrl+2" }
        },
        "session3": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 3",
          "default": { "mac": "ctrl+cmd+3", "other": "ctrl+3" }
        },
        "session4": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 4",
          "default": { "mac": "ctrl+cmd+4", "other": "ctrl+4" }
        },
        "session5": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 5",
          "default": { "mac": "ctrl+cmd+5", "other": "ctrl+5" }
        },
        "session6": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 6",
          "default": { "mac": "ctrl+cmd+6", "other": "ctrl+6" }
        },
        "session7": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 7",
          "default": { "mac": "ctrl+cmd+7", "other": "ctrl+7" }
        },
        "session8": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 8",
          "default": { "mac": "ctrl+cmd+8", "other": "ctrl+8" }
        },
        "session9": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to switch to session 9",
          "default": { "mac": "ctrl+cmd+9", "other": "ctrl+9" }
        },
        "renameBranch": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to rename the current branch",
          "default": "F2"
        },
        "runTask": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to open the task runner",
          "default": { "mac": "cmd+r", "other": "ctrl+shift+r" }
        },
        "taskSwitcher": {
          "$ref": "#/$defs/shortcut",
          "description": "Shortcut to open the task switcher",
          "default": { "mac": "cmd+;", "other": "ctrl+;" }
        }
      },
      "additionalProperties": false
    },
    "tasks": {
      "type": "array",
      "description": "Configurable tasks that can be run per-worktree",
      "items": {
        "$ref": "#/$defs/task"
      },
      "default": []
    }
  },
  "additionalProperties": false,
  "$defs": {
    "shortcutString": {
      "type": "string",
      "description": "A keyboard shortcut string. Format: 'mod+key' where mod is ctrl, cmd, alt, shift. 'cmd' = Cmd on macOS, Ctrl on other platforms.",
      "pattern": "^((ctrl|cmd|alt|shift)\\+)*(\\S+)$",
      "examples": ["ctrl+`", "cmd+c", "cmd+shift+p", "ctrl+shift+c"]
    },
    "platformShortcut": {
      "type": "object",
      "description": "Platform-specific shortcut mapping",
      "properties": {
        "mac": {
          "type": "string",
          "description": "Shortcut to use on macOS"
        },
        "other": {
          "type": "string",
          "description": "Shortcut to use on non-macOS platforms (Linux, Windows)"
        }
      },
      "additionalProperties": false
    },
    "shortcutEntry": {
      "oneOf": [
        { "$ref": "#/$defs/shortcutString" },
        { "$ref": "#/$defs/platformShortcut" }
      ],
      "description": "A shortcut entry: either a universal string or platform-specific object"
    },
    "shortcut": {
      "oneOf": [
        { "$ref": "#/$defs/shortcutString" },
        { "$ref": "#/$defs/platformShortcut" },
        {
          "type": "array",
          "items": { "$ref": "#/$defs/shortcutEntry" },
          "description": "An array of shortcut entries (strings and/or platform objects)"
        }
      ],
      "description": "A shortcut configuration: string, platform object, or array of both"
    },
    "task": {
      "type": "object",
      "description": "A configurable task that can be run in a worktree",
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name for the task (must be unique)"
        },
        "command": {
          "type": "string",
          "description": "Shell command to run. Supports minijinja: {{ branch }}, {{ branch | hash_port }}, {{ branch | sanitize }}, {{ branch | shell_escape }}"
        },
        "kind": {
          "type": "string",
          "enum": ["command", "daemon"],
          "description": "Task kind: 'command' runs to completion, 'daemon' stays running until stopped",
          "default": "command"
        },
        "silent": {
          "type": "boolean",
          "description": "If true, task runs without showing output in drawer",
          "default": false
        },
        "shell": {
          "type": "string",
          "description": "Override shell to run command with (e.g., '/bin/bash', 'fish')"
        },
        "env": {
          "type": "object",
          "description": "Environment variables to set when running the task. Values support minijinja: {{ branch }}, {{ branch | hash_port }}, {{ branch | sanitize }}, {{ branch | shell_escape }}",
          "additionalProperties": {
            "type": "string",
            "description": "Environment variable value (supports templates)"
          },
          "examples": [
            { "PORT": "3000" },
            { "PORT": "{{ branch | hash_port }}", "NODE_ENV": "development" }
          ]
        },
        "urls": {
          "type": "object",
          "description": "Named URL templates to display when task is running. Key is the link label, value is the URL template. Supports minijinja: {{ branch }}, {{ branch | hash_port }}, {{ branch | sanitize }}, {{ branch | shell_escape }}",
          "additionalProperties": {
            "type": "string",
            "description": "URL template"
          },
          "examples": [
            { "Dev": "http://localhost:3000" },
            { "Dev": "http://localhost:{{ branch | hash_port }}", "API": "http://localhost:{{ branch | hash_port }}/api" }
          ]
        }
      },
      "required": ["name", "command"],
      "additionalProperties": false
    }
  }
}
